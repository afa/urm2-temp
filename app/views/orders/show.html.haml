-# Фильтры

-# Дата отгрузки: даты c/по (см. календарик в шаблоне 008, compel_html_008/orders.html), params.date_from, params.date_to
-# Наименование: строка, params.item_name
-# Только мои позиции: вкл/выкл, params.only_my
-# Только ДМС: вкл/выкл, params.only_dms
-# Таблица:

.nav-title
 %span= link_to "Заказы", orders_path
 %span >
 %span.current Заказ #{params[:id]}

.content-wrap
 -# .filter-block
  = form_for :filter, :url => lines_orders_path, :html => {:method => :get} do |f|
   .filter
    %table
     %tr
      %th= f.label :item_name, t(:item_name)
      %td.long= f.text_field :item_name
     %tr
      %th Дата отгрузки:
      %td.tiny
       с&nbsp;
       %input.calendar-input{:type => "text", :name => 'filter[date_from]', :value => @filter.try(:date_from).blank? ? 1.month.ago.strftime("%Y-%m-%d") : @filter.date_from}
       -# .calendar-input= @filter.try(:date_from).blank? ? 1.month.ago.strftime("%Y-%m-%d") : @filter.date_from
       &nbsp;по&nbsp;
       %input.calendar-input{:type => "text", :name => 'filter[date_to]', :value => @filter.try(:date_to).blank? ? Date.current.strftime("%Y-%m-%d") : @filter.date_to}
       -# #ui-datepicker-div-container{:style=>"position: relative;"}
     %tr
      %th
      %td= render :partial => "shared/submit_button", :locals => {:title => "Найти!"}
      
   .clear.block-padded


 .table-navigation-block{:class => "scroll"}
  .table-block
   .table-scrolling
    = render :partial => "shared/pagination", :locals => {:page => @lines.page.to_i, :pages => @lines.total.to_i, :opts => {:show_numbers => false, :show_prevnext => true, :show_firstlast => true, :show_current => true, :text_before => "Записей: #{@lines.records}&nbsp;&nbsp;Страниц: #{@lines.total}&nbsp;&nbsp;".html_safe, :text_before_current => "Страница: "}}
    -# = render :partial => "shared/pagination", :locals => {:page => @lines.page.to_i, :pages => @lines.total.to_i}
    %table.table-style{:class => "order-list"}
     %tr
      %th ROHS
      %th= t(:item_name)
      %th Производитель
      %th Количество
      %th Цена
      %th Сумма
      %th Поставка
      %th Резерв
      %th В обработке складом
      %th Получено
      %th Продано
      %th Дата готовности
      %th Ожидаемая дата поставки
      %th Комментарий
      %th Требования
      %th Контактное лицо
      %th Проект

     = render :partial => "orders/showed_line", :collection => @lines.items

    .handle_sale
     .make_order
      выставление счета
      - form_for :order, :url => order_path, :html => {:method => "GET"}, :remote => true do |f1|
       = select_tag("order[#{params[:id]}][order_action]", "<option value=\"make\">Создать</option><option value=\"send\">Отправить</option><option value=\"make_send\">Создать и отправить</option>".html_safe)
       [#{t(:go)}]
     .close_sale
      закрыть заказ
      - form_for :order, :url => order_path, :html => {:method => "GET"}, :remote => true do |f2|
       = text_area_tag "order[#{params[:id]}][order_cancelation_reason]"
       [#{t(:close)}]
    .handle_lines
     .reserve_lines
      - form_for :order, :url => order_path, :html => {:method => "GET"}, :remote => true do |f3|
       [#{t(:reserve)}]
       [#{t(:unreserve_all)}]
     .pick_lines
      - form_for :order, :url => order_path, :html => {:method => "GET"}, :remote => true do |f4|
       = render :partial => ""
       [#{t(:pick)}]
     .reserve_transfer
      - form_for :order, :url => order_path, :html => {:method => "GET"}, :remote => true do |f5|
       = select_tag "order[#{params[:id]}][transferable_order]", "<option></option>".html_safe
       
     .remove_lines
      - form_for :order, :url => order_path, :html => {:method => "GET"}, :remote => true do |f6|
       = text_area_tag "order[#{params[:id]}][erase_reason]"
       [#{t(:remove)}]
     .price_request
      ???
    = render :partial => "order/info", :locals => {:order => @order_info}
-# :javascript
 if($(".calendar-input").length > 0){
 $(".calendar-input").datepicker({ dateFormat: 'yy-mm-dd', popupContainer: $('#ui-datepicker-div-container')});
 }

-# 
 =begin
  bank_account:
   title: "Расчётный счёт"
  comment:
   title: Комментарий
  company_code:
   title: Фирма
  currency_code:
   title: Валюта
  date_dead_line_delivery:
   title: "Дата готовности"
   type: date
  delivery_mode:
   title: "Способ поставки"
  document_number:
   title: Счёт
  external_invoice_num:
   title: "Накладная ТК"
  max_quotation_prognosis:
   title: "Срок поставки"
  paym_mode:
   title: "Способ оплаты"
  payment_status:
   title: "Статус оплаты"
  sales_amount:
   title: Сумма
  sales_date:
   title: "Дата заказа"
   type: date
  sales_ecommerce_status:
   title: "Статус в СОД"
  sales_id:
   title: "Номер заказа"
  sales_status:
   title: Статус
 =end

